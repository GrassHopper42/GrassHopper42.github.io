{"componentChunkName":"component---src-templates-post-jsx","path":"/spring-boot-localdatetime-error/","result":{"data":{"site":{"siteMetadata":{"title":"베짱이.dev"}},"markdownRemark":{"id":"eac17ad5-2bdc-59a0-9d0a-e2f6ccd6bd0a","excerpt":"오삽내 오늘의 삽질 내용 서비스 백엔드를 에서 으로 넘어가면서 까지 통으로 새로배우면서 뚝딱거리려니 힘들다. 그나마 로 타입지정하고 에서 데코레이션 달아보고 와 유사한 부분도 있어서 한결 수월하다는데 위안을 삼고 있다.\n오늘은 몇시간동안 낑낑거렸는데 허무하게 끝난 Trouble Shooting이 구글링할때 나오지 않은게 아쉬워 짧게나마 삽질 내용을 남겨보…","html":"<h2>오삽내</h2>\n<blockquote>\n<p>오늘의 삽질 내용</p>\n</blockquote>\n<p>서비스 백엔드를 <code class=\"language-text\">NestJS</code>에서 <code class=\"language-text\">Spring</code>으로 넘어가면서 <code class=\"language-text\">Java</code>까지 통으로 새로배우면서 뚝딱거리려니 힘들다. 그나마 <code class=\"language-text\">TypeScript</code>로 타입지정하고 <code class=\"language-text\">NestJS</code>에서 데코레이션 달아보고 <code class=\"language-text\">JavaScript</code>와 유사한 부분도 있어서 한결 수월하다는데 위안을 삼고 있다.\n오늘은 몇시간동안 낑낑거렸는데 허무하게 끝난 Trouble Shooting이 구글링할때 나오지 않은게 아쉬워 짧게나마 삽질 내용을 남겨보려한다.<br>\n<code class=\"language-text\">Spring Data Mongodb</code>로 DB연결하고 간단한 CRUD코드 몇개 만들어서 테스트를 돌려보는데 전혀 예상치도 못결 부분에서 에러가 터졌다.\n<code class=\"language-text\">createdAt</code>에 <code class=\"language-text\">Date</code>타입을 적용하기 위해 선언한 <code class=\"language-text\">LocalDateTime</code>타입에서 오류가 나서 클래스가 생성되지 못하고 꺼져버리는 것이었다.\n몇시간동안 구글링을 했는데 답이나오지 않아 스택오버플로우에 질문을 올리고 혼자 깨달음을 얻어 허무하게 끝나버렸다.</p>\n<h2>문제</h2>\n<p>아래는 <code class=\"language-text\">LocalDateTime</code>타입이 사용된 <code class=\"language-text\">User</code>모델의 일부이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// User.java</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LocalDateTime</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Data</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span>\n<span class=\"token annotation punctuation\">@Document</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"User\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Id</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">ObjectId</span> id<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@CreatedDate</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> createdAt<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@LastModifiedDate</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> updatedAt<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 상태로 테스트를 돌렸더니 아래의 에러를 볼 수 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">Caused by: java.lang.reflect.InaccessibleObjectException: Unable to make private java.time.LocalDateTime(java.time.LocalDate,java.time.LocalTime) accessible: module java.base does not &quot;opens java.time&quot; to unnamed module</code></pre></div>\n<p>이 에러 문구를 가지고 이렇게 저렇게 조합해보면서 구글링을 하다가 한 <a href=\"https://stackoverflow.com/questions/70412805/what-does-this-error-mean-java-lang-reflect-inaccessibleobjectexception-unable\">스택오버플로우 답변</a>을 발견했다.</p>\n<p><code class=\"language-text\">start-argument</code>로 <code class=\"language-text\">--add-opens java.base/java.time=ALL-UNNAMED</code>를 입력하라는 글이었는데, 이게 도통 뭔소리고 VSC에서 어떻게 입력해줘야 할지도 모르겠어서 넘겨버렸다.\n한참 낑낑대다가 스택오버플로우 질문을 남겼더니 위 답변의 링크를 주면서 이걸로 해결이 안되냐는 코멘트가 달렸다. 이게 진짜 되는건가 하고 VSC로 vm 설정하는 법을 찾아서 입력해봤다.</p>\n<blockquote>\n<p>VSC에서 위와 같은 args를 입력하기 위해서는 상단 <strong>Run</strong>탭에서 <strong>Add Configuration</strong>을 누르고 뜨는 <code class=\"language-text\">launch.json</code>에 <code class=\"language-text\">vmArgs</code>을 키로 추가한 뒤 값에는 <code class=\"language-text\">-add-opens java.base/...</code>을 입력해주면 된다.\nIDE 짱짱맨... vim은 그냥 VSC 플러그인으로만 쓰는걸로...</p>\n</blockquote>\n<h2>해결</h2>\n<p>이제 Application 구동은 되는데 여전히 test에서는 같은 에러가 뜬다. 뭐가 문제인가 하고 Application을 다시 실행해 봤더니 로그에서 아래와 같은 경고문구를 볼 수 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">WARN 17980 --- [  restartedMain] o.s.data.convert.CustomConversions       : Registering converter from class java.time.LocalDateTime to class org.joda.time.LocalDateTime as reading converter although it doesn&#39;t convert from a store-supported type; You might want to check your annotation setup at the converter implementation</code></pre></div>\n<p>시스템에서 <code class=\"language-text\">java.time.LocalDateTime</code>을 <code class=\"language-text\">org.joda.time.LocalDateTime</code>으로 convert 시켜같는 것 같다. 그래서 convert할 필요 없게 package를 바꿔줬다. 아래는 바뀐 코드이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// User.java</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>joda<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LocalDateTime</span></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 바뀐부분</span>\n\n<span class=\"token annotation punctuation\">@Data</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span>\n<span class=\"token annotation punctuation\">@Document</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"User\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token annotation punctuation\">@Id</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">ObjectId</span> id<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@CreatedDate</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> createdAt<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@LastModifiedDate</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> updatedAt<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다른 모델도 다 바꿔줬다. 이제 테스트에서도 에러가 뜨지 않고 잘 돌아간다.</p>\n<h2>이유</h2>\n<p>는 잘 모르겠다... 구글링하다보니 <code class=\"language-text\">java.time</code> 뿐만 아니라 <code class=\"language-text\">java.util</code>같은 다른 자바 내장 패키지들도 이따금 private으로 선언하면 비슷한 에러를 띄우는것 같았다.\n<code class=\"language-text\">java.time</code>의 <code class=\"language-text\">ZonedDateTime</code>을 사용하는 경우도 있는것 같았는데 이건 자체적으로 convert가 되지 않는 것 같다.\n그래서 Converter를 따로 구현해서 주입해줘야 한다. <a href=\"https://www.baeldung.com/spring-data-mongodb-zoneddatetime\">참고</a><br>\nLocalDateTime과 ZonedDateTime의 차이를 비교해보고 더 유용하겠다 싶으면 적용해봐야겠다.</p>\n<h2>참고자료</h2>\n<p><a href=\"https://stackoverflow.com/questions/70412805/what-does-this-error-mean-java-lang-reflect-inaccessibleobjectexception-unable\">StackOverflow</a>\n<a href=\"https://www.baeldung.com/spring-data-mongodb-zoneddatetime\">ZonedDateTime Converter</a>\n<a href=\"https://d2.naver.com/helloworld/645609\">NaverD2</a></p>","frontmatter":{"title":"[오삽내]private LocalDateTime 에러 해결...","date":"July 07, 2022","update":"July 07, 2022","tags":["Java","Spring","Mongodb","TroubleShooting"],"series":null},"fields":{"slug":"/spring-boot-localdatetime-error/","readingTime":{"minutes":4.935}}},"seriesList":{"edges":[{"node":{"id":"1df815ad-a8af-5b8e-9873-8b8115df804e","fields":{"slug":"/hello-world/"},"frontmatter":{"title":"Hello World!"}}},{"node":{"id":"b61a6bf6-30d5-5468-bca6-8c4399512593","fields":{"slug":"/nestjs-prisma-dbhandling/"},"frontmatter":{"title":"[NestJS]NestJS에서 Prisma 사용하기"}}},{"node":{"id":"5e97337a-e3ed-5e87-b9f7-a96f25f34820","fields":{"slug":"/gatsby-analytics/"},"frontmatter":{"title":"[Gatsby]블로그에 Google Analytics 연결"}}},{"node":{"id":"eac17ad5-2bdc-59a0-9d0a-e2f6ccd6bd0a","fields":{"slug":"/spring-boot-localdatetime-error/"},"frontmatter":{"title":"[오삽내]private LocalDateTime 에러 해결..."}}},{"node":{"id":"19c883bf-49e6-54a9-a7d6-a4413c774981","fields":{"slug":"/tmux-init/"},"frontmatter":{"title":"Tmux Setting"}}}]},"previous":{"fields":{"slug":"/gatsby-analytics/"},"frontmatter":{"title":"[Gatsby]블로그에 Google Analytics 연결"}},"next":{"fields":{"slug":"/tmux-init/"},"frontmatter":{"title":"Tmux Setting"}}},"pageContext":{"id":"eac17ad5-2bdc-59a0-9d0a-e2f6ccd6bd0a","series":null,"previousPostId":"5e97337a-e3ed-5e87-b9f7-a96f25f34820","nextPostId":"19c883bf-49e6-54a9-a7d6-a4413c774981"}},"staticQueryHashes":[]}